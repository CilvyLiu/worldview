import pandas as pd
import akshare as ak
import streamlit as st
import io
from datetime import datetime

# ==================== 1. 核心标的代码映射 (补齐 28 只) ====================
WANGWANG_MAP = [
    {"战队": "🛡️ 压舱石", "名称": "中国神华", "代码": "601088"},
    {"战队": "🛡️ 压舱石", "名称": "长江电力", "代码": "600900"},
    {"战队": "🛡️ 压舱石", "名称": "工商银行", "代码": "601398"},
    {"战队": "🛡️ 压舱石", "名称": "中国石油", "代码": "601857"},
    {"战队": "🛡️ 压舱石", "名称": "农业银行", "代码": "601288"},
    {"战队": "🛡️ 压舱石", "名称": "陕西煤业", "代码": "601225"},
    {"战队": "🛡️ 压舱石", "名称": "中国建筑", "代码": "601668"},
    {"战队": "⚔️ 冲锋队", "名称": "东方财富", "代码": "300059"},
    {"战队": "⚔️ 冲锋队", "名称": "中信证券", "代码": "600030"},
    {"战队": "⚔️ 冲锋队", "名称": "宁德时代", "代码": "300750"},
    {"战队": "⚔️ 冲锋队", "名称": "比亚迪", "代码": "002594"},
    {"战队": "⚔️ 冲锋队", "名称": "工业富联", "代码": "601138"},
    {"战队": "⚔️ 冲锋队", "名称": "中信建投", "代码": "601066"},
    {"战队": "⚔️ 冲锋队", "名称": "泸州老窖", "代码": "000568"},
    {"战队": "🏗️ 稳增长", "名称": "紫金矿业", "代码": "601899"},
    {"战队": "🏗️ 稳增长", "名称": "万华化学", "代码": "600309"},
    {"战队": "🏗️ 稳增长", "名称": "海螺水泥", "代码": "600585"},
    {"战队": "🏗️ 稳增长", "名称": "三一重工", "代码": "600031"},
    {"战队": "🏗️ 稳增长", "名称": "宝钢股份", "代码": "600019"},
    {"战队": "🏗️ 稳增长", "名称": "中国中铁", "代码": "601390"},
    {"战队": "🏗️ 稳增长", "名称": "中国电建", "代码": "601669"},
    {"战队": "📈 守护者", "名称": "招商银行", "代码": "600036"},
    {"战队": "📈 守护者", "名称": "中国平安", "代码": "601318"},
    {"战队": "📈 守护者", "名称": "贵州茅台", "代码": "600519"},
    {"战队": "📈 守护者", "名称": "五粮液", "代码": "000858"},
    {"战队": "📈 守护者", "名称": "美的集团", "代码": "000333"},
    {"战队": "📈 守护者", "名称": "兴业银行", "代码": "601166"},
    {"战队": "📈 守护者", "名称": "格力电器", "代码": "000651"}
]

# ==================== 2. 全自动强力取数引擎 ====================
class NovaPowerEngine:
    @staticmethod
    def get_market_data():
        """强制多口径抓取：指数、市值、PMI"""
        data = {"PMI": 50.1, "SH": 0.0, "SZ": 0.0, "Total_MV": 880000.0}
        try:
            # 1. 抓取指数快照
            idx_df = ak.stock_zh_index_spot_em()
            # 兼容处理：有些接口返回'上证指数'，有些是'上证系列指数'
            sh_val = idx_df[idx_df['名称'].str.contains('上证指数', na=False)]['涨跌幅'].values
            sz_val = idx_df[idx
